/*
 * This code was auto generated by make_hipo2root.py
 * Do not modify this program.
 *
 *
 *
 * Author: Nick Tyler, University Of South Carolina
 */
// Standard libs
#include <cstdlib>
#include <iostream>
#include <time.h>
#include <vector>
// ROOT libs
#include "TFile.h"
#include "TROOT.h"
#include "TTree.h"
// Hipo libs and clipp
#include "banks.h"
#include "clipp.h"
#include "hipo4/reader.h"

int main(int argc, char** argv) {
  ROOT::EnableThreadSafety();
  ROOT::EnableImplicitMT(2);
  std::string InFileName;
  std::string OutFileName;
  bool        is_mc      = false;
  bool        is_batch   = false;
  bool        is_test    = false;
  bool        print_help = false;
  bool        cov        = false;
  bool        traj       = false;
  bool        tbt        = false;
  bool        hits       = false;

  auto cli =
      (clipp::option("-h", "--help").set(print_help) % "print help",
       clipp::option("-mc", "--MC").set(is_mc) % "Convert dst and mc banks",
       clipp::option("-b", "--batch").set(is_batch) % "Don't show progress and statistics",
       clipp::option("-c", "--cov").set(cov) % "Save Covariant Matrix for kinematic fitting",
       clipp::option("-hits", "--hits").set(hits) % "Save CND::hits, CND::clusters, CTOF::hits",
       clipp::option("-t", "--traj").set(traj) % "Save traj information",
       clipp::option("-tbt", "--tbt").set(tbt) % "Save TimeBasedTrkg information",
       clipp::option("-test", "--test").set(is_test) %
           "Only convert first 50000 events for testing",
       clipp::value("inputFile.hipo", InFileName),
       clipp::opt_value("outputFile.root", OutFileName));

  clipp::parse(argc, argv, cli);
  if (print_help || InFileName.empty()) {
    std::cout << clipp::make_man_page(cli, argv[0]);
    exit(0);
  }

  if (OutFileName.empty())
    OutFileName = InFileName + ".root";

  TFile* OutputFile = new TFile(OutFileName.c_str(), "RECREATE");
  OutputFile->SetCompressionSettings(404); // kUseAnalysis
  TTree* clas12 = new TTree("clas12", "clas12");

  auto   reader          = std::make_shared<hipo::reader>(InFileName);
  size_t tot_hipo_events = reader->numEvents();

  auto dict = std::make_shared<hipo::dictionary>();
  reader->readDictionary(*dict);
  auto hipo_event = std::make_shared<hipo::event>();

  // Event config
  auto run_Config = std::make_shared<hipo::bank>(dict->getSchema("RUN::config"));
  auto rec_Event  = std::make_shared<hipo::bank>(dict->getSchema("REC::Event"));
  auto hel_Online = std::make_shared<hipo::bank>(dict->getSchema("HEL::online"));
  auto hel_Flip   = std::make_shared<hipo::bank>(dict->getSchema("HEL::flip"));

  // Physics
  auto rec_Particle      = std::make_shared<hipo::bank>(dict->getSchema("REC::Particle"));
  auto rec_Calorimeter   = std::make_shared<hipo::bank>(dict->getSchema("REC::Calorimeter"));
  auto rec_Scintillator  = std::make_shared<hipo::bank>(dict->getSchema("REC::Scintillator"));
  auto rec_Cherenkov     = std::make_shared<hipo::bank>(dict->getSchema("REC::Cherenkov"));
  auto rec_Track         = std::make_shared<hipo::bank>(dict->getSchema("REC::Track"));
  auto rec_ForwardTagger = std::make_shared<hipo::bank>(dict->getSchema("REC::ForwardTagger"));
  auto rec_Traj          = std::make_shared<hipo::bank>(dict->getSchema("REC::Traj"));
  auto rec_CovMat        = std::make_shared<hipo::bank>(dict->getSchema("REC::CovMat"));

  // Monte Carlo only banks
  auto mc_Header   = std::make_shared<hipo::bank>(dict->getSchema("MC::Header"));
  auto mc_Event    = std::make_shared<hipo::bank>(dict->getSchema("MC::Event"));
  auto mc_Particle = std::make_shared<hipo::bank>(dict->getSchema("MC::Particle"));
  auto mc_Lund     = std::make_shared<hipo::bank>(dict->getSchema("MC::Lund"));

  // Time Based Tracking Banks
  auto tbt_Tracks  = std::make_shared<hipo::bank>(dict->getSchema("TimeBasedTrkg::TBTracks"));
  auto tbt_Crosses = std::make_shared<hipo::bank>(dict->getSchema("TimeBasedTrkg::TBCrosses"));
  auto tbt_Hits    = std::make_shared<hipo::bank>(dict->getSchema("TimeBasedTrkg::TBHits"));

  // CND and CTOF hits
  auto cnd_Hits     = std::make_shared<hipo::bank>(dict->getSchema("CND::hits"));
  auto cnd_Clusters = std::make_shared<hipo::bank>(dict->getSchema("CND::clusters"));
  auto ctof_Hits    = std::make_shared<hipo::bank>(dict->getSchema("CTOF::hits"));

  clas12->Branch("RUN_Config_run", &RUN_Config_run);
  clas12->Branch("RUN_Config_event", &RUN_Config_event);
  clas12->Branch("RUN_Config_unixtime", &RUN_Config_unixtime);
  clas12->Branch("RUN_Config_trigger", &RUN_Config_trigger);
  clas12->Branch("RUN_Config_timestamp", &RUN_Config_timestamp);
  clas12->Branch("RUN_Config_type", &RUN_Config_type);
  clas12->Branch("RUN_Config_mode", &RUN_Config_mode);
  clas12->Branch("RUN_Config_torus", &RUN_Config_torus);
  clas12->Branch("RUN_Config_solenoid", &RUN_Config_solenoid);

  clas12->Branch("REC_Event_category", &REC_Event_category);
  clas12->Branch("REC_Event_topology", &REC_Event_topology);
  clas12->Branch("REC_Event_beamCharge", &REC_Event_beamCharge);
  clas12->Branch("REC_Event_liveTime", &REC_Event_liveTime);
  clas12->Branch("REC_Event_startTime", &REC_Event_startTime);
  clas12->Branch("REC_Event_RFTime", &REC_Event_RFTime);
  clas12->Branch("REC_Event_helicity", &REC_Event_helicity);
  clas12->Branch("REC_Event_helicityRaw", &REC_Event_helicityRaw);
  clas12->Branch("REC_Event_procTime", &REC_Event_procTime);

  clas12->Branch("HEL_Online_helicity", &HEL_Online_helicity);
  clas12->Branch("HEL_Online_helicityRaw", &HEL_Online_helicityRaw);

  clas12->Branch("HEL_Flip_run", &HEL_Flip_run);
  clas12->Branch("HEL_Flip_event", &HEL_Flip_event);
  clas12->Branch("HEL_Flip_timestamp", &HEL_Flip_timestamp);
  clas12->Branch("HEL_Flip_helicity", &HEL_Flip_helicity);
  clas12->Branch("HEL_Flip_helicityRaw", &HEL_Flip_helicityRaw);
  clas12->Branch("HEL_Flip_pair", &HEL_Flip_pair);
  clas12->Branch("HEL_Flip_pattern", &HEL_Flip_pattern);
  clas12->Branch("HEL_Flip_status", &HEL_Flip_status);

  clas12->Branch("REC_Particle_pid", &REC_Particle_pid_vec);
  clas12->Branch("REC_Particle_px", &REC_Particle_px_vec);
  clas12->Branch("REC_Particle_py", &REC_Particle_py_vec);
  clas12->Branch("REC_Particle_pz", &REC_Particle_pz_vec);
  clas12->Branch("REC_Particle_vx", &REC_Particle_vx_vec);
  clas12->Branch("REC_Particle_vy", &REC_Particle_vy_vec);
  clas12->Branch("REC_Particle_vz", &REC_Particle_vz_vec);
  clas12->Branch("REC_Particle_vt", &REC_Particle_vt_vec);
  clas12->Branch("REC_Particle_charge", &REC_Particle_charge_vec);
  clas12->Branch("REC_Particle_beta", &REC_Particle_beta_vec);
  clas12->Branch("REC_Particle_chi2pid", &REC_Particle_chi2pid_vec);
  clas12->Branch("REC_Particle_status", &REC_Particle_status_vec);

  if (is_mc) {
    clas12->Branch("MC_Header_run", &MC_Header_run_vec);
    clas12->Branch("MC_Header_event", &MC_Header_event_vec);
    clas12->Branch("MC_Header_type", &MC_Header_type_vec);
    clas12->Branch("MC_Header_helicity", &MC_Header_helicity_vec);

    clas12->Branch("MC_Event_npart", &MC_Event_npart_vec);
    clas12->Branch("MC_Event_ebeam", &MC_Event_ebeam_vec);
    clas12->Branch("MC_Event_weight", &MC_Event_weight_vec);

    clas12->Branch("MC_Particle_pid", &MC_Particle_pid_vec);
    clas12->Branch("MC_Particle_px", &MC_Particle_px_vec);
    clas12->Branch("MC_Particle_py", &MC_Particle_py_vec);
    clas12->Branch("MC_Particle_pz", &MC_Particle_pz_vec);
    clas12->Branch("MC_Particle_vx", &MC_Particle_vx_vec);
    clas12->Branch("MC_Particle_vy", &MC_Particle_vy_vec);
    clas12->Branch("MC_Particle_vz", &MC_Particle_vz_vec);
    clas12->Branch("MC_Particle_vt", &MC_Particle_vt_vec);

    clas12->Branch("MC_Lund_pid", &MC_Lund_pid_vec);
    clas12->Branch("MC_Lund_mass", &MC_Lund_mass_vec);
    clas12->Branch("MC_Lund_E", &MC_Lund_E_vec);
    clas12->Branch("MC_Lund_px", &MC_Lund_px_vec);
    clas12->Branch("MC_Lund_py", &MC_Lund_py_vec);
    clas12->Branch("MC_Lund_pz", &MC_Lund_pz_vec);
    clas12->Branch("MC_Lund_vx", &MC_Lund_vx_vec);
    clas12->Branch("MC_Lund_vy", &MC_Lund_vy_vec);
    clas12->Branch("MC_Lund_vz", &MC_Lund_vz_vec);
  }

  clas12->Branch("REC_Calorimeter_index", &REC_Calorimeter_index_vec);
  clas12->Branch("REC_Calorimeter_pindex", &REC_Calorimeter_pindex_vec);
  clas12->Branch("REC_Calorimeter_detector", &REC_Calorimeter_detector_vec);
  clas12->Branch("REC_Calorimeter_sector", &REC_Calorimeter_sector_vec);
  clas12->Branch("REC_Calorimeter_layer", &REC_Calorimeter_layer_vec);
  clas12->Branch("REC_Calorimeter_energy", &REC_Calorimeter_energy_vec);
  clas12->Branch("REC_Calorimeter_time", &REC_Calorimeter_time_vec);
  clas12->Branch("REC_Calorimeter_path", &REC_Calorimeter_path_vec);
  clas12->Branch("REC_Calorimeter_chi2", &REC_Calorimeter_chi2_vec);
  clas12->Branch("REC_Calorimeter_x", &REC_Calorimeter_x_vec);
  clas12->Branch("REC_Calorimeter_y", &REC_Calorimeter_y_vec);
  clas12->Branch("REC_Calorimeter_z", &REC_Calorimeter_z_vec);
  clas12->Branch("REC_Calorimeter_hx", &REC_Calorimeter_hx_vec);
  clas12->Branch("REC_Calorimeter_hy", &REC_Calorimeter_hy_vec);
  clas12->Branch("REC_Calorimeter_hz", &REC_Calorimeter_hz_vec);
  clas12->Branch("REC_Calorimeter_lu", &REC_Calorimeter_lu_vec);
  clas12->Branch("REC_Calorimeter_lv", &REC_Calorimeter_lv_vec);
  clas12->Branch("REC_Calorimeter_lw", &REC_Calorimeter_lw_vec);
  clas12->Branch("REC_Calorimeter_du", &REC_Calorimeter_du_vec);
  clas12->Branch("REC_Calorimeter_dv", &REC_Calorimeter_dv_vec);
  clas12->Branch("REC_Calorimeter_dw", &REC_Calorimeter_dw_vec);
  clas12->Branch("REC_Calorimeter_m2u", &REC_Calorimeter_m2u_vec);
  clas12->Branch("REC_Calorimeter_m2v", &REC_Calorimeter_m2v_vec);
  clas12->Branch("REC_Calorimeter_m2w", &REC_Calorimeter_m2w_vec);
  clas12->Branch("REC_Calorimeter_m3u", &REC_Calorimeter_m3u_vec);
  clas12->Branch("REC_Calorimeter_m3v", &REC_Calorimeter_m3v_vec);
  clas12->Branch("REC_Calorimeter_m3w", &REC_Calorimeter_m3w_vec);
  clas12->Branch("REC_Calorimeter_status", &REC_Calorimeter_status_vec);
  clas12->Branch("REC_Cherenkov_index", &REC_Cherenkov_index_vec);
  clas12->Branch("REC_Cherenkov_pindex", &REC_Cherenkov_pindex_vec);
  clas12->Branch("REC_Cherenkov_detector", &REC_Cherenkov_detector_vec);
  clas12->Branch("REC_Cherenkov_sector", &REC_Cherenkov_sector_vec);
  clas12->Branch("REC_Cherenkov_nphe", &REC_Cherenkov_nphe_vec);
  clas12->Branch("REC_Cherenkov_time", &REC_Cherenkov_time_vec);
  clas12->Branch("REC_Cherenkov_path", &REC_Cherenkov_path_vec);
  clas12->Branch("REC_Cherenkov_chi2", &REC_Cherenkov_chi2_vec);
  clas12->Branch("REC_Cherenkov_x", &REC_Cherenkov_x_vec);
  clas12->Branch("REC_Cherenkov_y", &REC_Cherenkov_y_vec);
  clas12->Branch("REC_Cherenkov_z", &REC_Cherenkov_z_vec);
  clas12->Branch("REC_Cherenkov_dtheta", &REC_Cherenkov_dtheta_vec);
  clas12->Branch("REC_Cherenkov_dphi", &REC_Cherenkov_dphi_vec);
  clas12->Branch("REC_Cherenkov_status", &REC_Cherenkov_status_vec);
  clas12->Branch("REC_ForwardTagger_index", &REC_ForwardTagger_index_vec);
  clas12->Branch("REC_ForwardTagger_pindex", &REC_ForwardTagger_pindex_vec);
  clas12->Branch("REC_ForwardTagger_detector", &REC_ForwardTagger_detector_vec);
  clas12->Branch("REC_ForwardTagger_layer", &REC_ForwardTagger_layer_vec);
  clas12->Branch("REC_ForwardTagger_energy", &REC_ForwardTagger_energy_vec);
  clas12->Branch("REC_ForwardTagger_time", &REC_ForwardTagger_time_vec);
  clas12->Branch("REC_ForwardTagger_path", &REC_ForwardTagger_path_vec);
  clas12->Branch("REC_ForwardTagger_chi2", &REC_ForwardTagger_chi2_vec);
  clas12->Branch("REC_ForwardTagger_x", &REC_ForwardTagger_x_vec);
  clas12->Branch("REC_ForwardTagger_y", &REC_ForwardTagger_y_vec);
  clas12->Branch("REC_ForwardTagger_z", &REC_ForwardTagger_z_vec);
  clas12->Branch("REC_ForwardTagger_dx", &REC_ForwardTagger_dx_vec);
  clas12->Branch("REC_ForwardTagger_dy", &REC_ForwardTagger_dy_vec);
  clas12->Branch("REC_ForwardTagger_radius", &REC_ForwardTagger_radius_vec);
  clas12->Branch("REC_ForwardTagger_size", &REC_ForwardTagger_size_vec);
  clas12->Branch("REC_ForwardTagger_status", &REC_ForwardTagger_status_vec);
  clas12->Branch("REC_Scintillator_index", &REC_Scintillator_index_vec);
  clas12->Branch("REC_Scintillator_pindex", &REC_Scintillator_pindex_vec);
  clas12->Branch("REC_Scintillator_detector", &REC_Scintillator_detector_vec);
  clas12->Branch("REC_Scintillator_sector", &REC_Scintillator_sector_vec);
  clas12->Branch("REC_Scintillator_layer", &REC_Scintillator_layer_vec);
  clas12->Branch("REC_Scintillator_component", &REC_Scintillator_component_vec);
  clas12->Branch("REC_Scintillator_energy", &REC_Scintillator_energy_vec);
  clas12->Branch("REC_Scintillator_time", &REC_Scintillator_time_vec);
  clas12->Branch("REC_Scintillator_path", &REC_Scintillator_path_vec);
  clas12->Branch("REC_Scintillator_chi2", &REC_Scintillator_chi2_vec);
  clas12->Branch("REC_Scintillator_x", &REC_Scintillator_x_vec);
  clas12->Branch("REC_Scintillator_y", &REC_Scintillator_y_vec);
  clas12->Branch("REC_Scintillator_z", &REC_Scintillator_z_vec);
  clas12->Branch("REC_Scintillator_hx", &REC_Scintillator_hx_vec);
  clas12->Branch("REC_Scintillator_hy", &REC_Scintillator_hy_vec);
  clas12->Branch("REC_Scintillator_hz", &REC_Scintillator_hz_vec);
  clas12->Branch("REC_Scintillator_status", &REC_Scintillator_status_vec);
  clas12->Branch("REC_Track_index", &REC_Track_index_vec);
  clas12->Branch("REC_Track_pindex", &REC_Track_pindex_vec);
  clas12->Branch("REC_Track_detector", &REC_Track_detector_vec);
  clas12->Branch("REC_Track_sector", &REC_Track_sector_vec);
  clas12->Branch("REC_Track_status", &REC_Track_status_vec);
  clas12->Branch("REC_Track_q", &REC_Track_q_vec);
  clas12->Branch("REC_Track_chi2", &REC_Track_chi2_vec);
  clas12->Branch("REC_Track_NDF", &REC_Track_NDF_vec);
  if (tbt) {
    clas12->Branch("TBT_Tracks_id", &TBT_Tracks_id_vec);
    clas12->Branch("TBT_Tracks_sector", &TBT_Tracks_sector_vec);
    clas12->Branch("TBT_Tracks_vx", &TBT_Tracks_vx_vec);
    clas12->Branch("TBT_Tracks_vy", &TBT_Tracks_vy_vec);
    clas12->Branch("TBT_Tracks_vz", &TBT_Tracks_vz_vec);
    clas12->Branch("TBT_Tracks_Cross1_ID", &TBT_Tracks_Cross1_ID_vec);
    clas12->Branch("TBT_Tracks_Cross2_ID", &TBT_Tracks_Cross2_ID_vec);
    clas12->Branch("TBT_Tracks_Cross3_ID", &TBT_Tracks_Cross3_ID_vec);
    clas12->Branch("TBT_Tracks_chi2", &TBT_Tracks_chi2_vec);
    clas12->Branch("TBT_Tracks_ndf", &TBT_Tracks_ndf_vec);
    clas12->Branch("TBT_Crosses_id", &TBT_Crosses_id_vec);
    clas12->Branch("TBT_Crosses_sector", &TBT_Crosses_sector_vec);
    clas12->Branch("TBT_Crosses_region", &TBT_Crosses_region_vec);
    clas12->Branch("TBT_Crosses_x", &TBT_Crosses_x_vec);
    clas12->Branch("TBT_Crosses_y", &TBT_Crosses_y_vec);
    clas12->Branch("TBT_Crosses_z", &TBT_Crosses_z_vec);
    clas12->Branch("TBT_Crosses_err_x", &TBT_Crosses_err_x_vec);
    clas12->Branch("TBT_Crosses_err_y", &TBT_Crosses_err_y_vec);
    clas12->Branch("TBT_Crosses_err_z", &TBT_Crosses_err_z_vec);
    clas12->Branch("TBT_Crosses_ux", &TBT_Crosses_ux_vec);
    clas12->Branch("TBT_Crosses_uy", &TBT_Crosses_uy_vec);
    clas12->Branch("TBT_Crosses_uz", &TBT_Crosses_uz_vec);
    clas12->Branch("TBT_Crosses_err_ux", &TBT_Crosses_err_ux_vec);
    clas12->Branch("TBT_Crosses_err_uy", &TBT_Crosses_err_uy_vec);
    clas12->Branch("TBT_Crosses_err_uz", &TBT_Crosses_err_uz_vec);
    clas12->Branch("TBT_Hits_id", &TBT_Hits_id_vec);
    clas12->Branch("TBT_Hits_sector", &TBT_Hits_sector_vec);
    clas12->Branch("TBT_Hits_superlayer", &TBT_Hits_superlayer_vec);
    clas12->Branch("TBT_Hits_layer", &TBT_Hits_layer_vec);
    clas12->Branch("TBT_Hits_wire", &TBT_Hits_wire_vec);
    clas12->Branch("TBT_Hits_trkID", &TBT_Hits_trkID_vec);
    clas12->Branch("TBT_Hits_doca", &TBT_Hits_doca_vec);
    clas12->Branch("TBT_Hits_docaError", &TBT_Hits_docaError_vec);
    clas12->Branch("TBT_Hits_trkDoca", &TBT_Hits_trkDoca_vec);
    clas12->Branch("TBT_Hits_timeResidual", &TBT_Hits_timeResidual_vec);
    clas12->Branch("TBT_Hits_fitResidual", &TBT_Hits_fitResidual_vec);
  }
  if (cov) {
    clas12->Branch("REC_CovMat_index", &REC_CovMat_index_vec);
    clas12->Branch("REC_CovMat_pindex", &REC_CovMat_pindex_vec);
    clas12->Branch("REC_CovMat_C11", &REC_CovMat_C11_vec);
    clas12->Branch("REC_CovMat_C12", &REC_CovMat_C12_vec);
    clas12->Branch("REC_CovMat_C13", &REC_CovMat_C13_vec);
    clas12->Branch("REC_CovMat_C14", &REC_CovMat_C14_vec);
    clas12->Branch("REC_CovMat_C15", &REC_CovMat_C15_vec);
    clas12->Branch("REC_CovMat_C22", &REC_CovMat_C22_vec);
    clas12->Branch("REC_CovMat_C23", &REC_CovMat_C23_vec);
    clas12->Branch("REC_CovMat_C24", &REC_CovMat_C24_vec);
    clas12->Branch("REC_CovMat_C25", &REC_CovMat_C25_vec);
    clas12->Branch("REC_CovMat_C33", &REC_CovMat_C33_vec);
    clas12->Branch("REC_CovMat_C34", &REC_CovMat_C34_vec);
    clas12->Branch("REC_CovMat_C35", &REC_CovMat_C35_vec);
    clas12->Branch("REC_CovMat_C44", &REC_CovMat_C44_vec);
    clas12->Branch("REC_CovMat_C45", &REC_CovMat_C45_vec);
    clas12->Branch("REC_CovMat_C55", &REC_CovMat_C55_vec);
  }
  if (traj) {
    clas12->Branch("REC_Traj_pindex", &REC_Traj_pindex_vec);
    clas12->Branch("REC_Traj_index", &REC_Traj_index_vec);
    clas12->Branch("REC_Traj_detector", &REC_Traj_detector_vec);
    clas12->Branch("REC_Traj_layer", &REC_Traj_layer_vec);
    clas12->Branch("REC_Traj_x", &REC_Traj_x_vec);
    clas12->Branch("REC_Traj_y", &REC_Traj_y_vec);
    clas12->Branch("REC_Traj_z", &REC_Traj_z_vec);
    clas12->Branch("REC_Traj_cx", &REC_Traj_cx_vec);
    clas12->Branch("REC_Traj_cy", &REC_Traj_cy_vec);
    clas12->Branch("REC_Traj_cz", &REC_Traj_cz_vec);
    clas12->Branch("REC_Traj_path", &REC_Traj_path_vec);
  }
  if (hits) {
    clas12->Branch("CND_Hits_id", &CND_Hits_id_vec);
    clas12->Branch("CND_Hits_status", &CND_Hits_status_vec);
    clas12->Branch("CND_Hits_trkID", &CND_Hits_trkID_vec);
    clas12->Branch("CND_Hits_sector", &CND_Hits_sector_vec);
    clas12->Branch("CND_Hits_layer", &CND_Hits_layer_vec);
    clas12->Branch("CND_Hits_component", &CND_Hits_component_vec);
    clas12->Branch("CND_Hits_energy", &CND_Hits_energy_vec);
    clas12->Branch("CND_Hits_time", &CND_Hits_time_vec);
    clas12->Branch("CND_Hits_energy_unc", &CND_Hits_energy_unc_vec);
    clas12->Branch("CND_Hits_time_unc", &CND_Hits_time_unc_vec);
    clas12->Branch("CND_Hits_x", &CND_Hits_x_vec);
    clas12->Branch("CND_Hits_y", &CND_Hits_y_vec);
    clas12->Branch("CND_Hits_z", &CND_Hits_z_vec);
    clas12->Branch("CND_Hits_x_unc", &CND_Hits_x_unc_vec);
    clas12->Branch("CND_Hits_y_unc", &CND_Hits_y_unc_vec);
    clas12->Branch("CND_Hits_z_unc", &CND_Hits_z_unc_vec);
    clas12->Branch("CND_Hits_tx", &CND_Hits_tx_vec);
    clas12->Branch("CND_Hits_ty", &CND_Hits_ty_vec);
    clas12->Branch("CND_Hits_tz", &CND_Hits_tz_vec);
    clas12->Branch("CND_Hits_tlength", &CND_Hits_tlength_vec);
    clas12->Branch("CND_Hits_pathlength", &CND_Hits_pathlength_vec);
    clas12->Branch("CND_Hits_indexLadc", &CND_Hits_indexLadc_vec);
    clas12->Branch("CND_Hits_indexRadc", &CND_Hits_indexRadc_vec);
    clas12->Branch("CND_Hits_indexLtdc", &CND_Hits_indexLtdc_vec);
    clas12->Branch("CND_Hits_indexRtdc", &CND_Hits_indexRtdc_vec);

    clas12->Branch("CND_Clusters_id", &CND_Clusters_id_vec);
    clas12->Branch("CND_Clusters_sector", &CND_Clusters_sector_vec);
    clas12->Branch("CND_Clusters_layer", &CND_Clusters_layer_vec);
    clas12->Branch("CND_Clusters_component", &CND_Clusters_component_vec);
    clas12->Branch("CND_Clusters_nhits", &CND_Clusters_nhits_vec);
    clas12->Branch("CND_Clusters_energy", &CND_Clusters_energy_vec);
    clas12->Branch("CND_Clusters_x", &CND_Clusters_x_vec);
    clas12->Branch("CND_Clusters_y", &CND_Clusters_y_vec);
    clas12->Branch("CND_Clusters_z", &CND_Clusters_z_vec);
    clas12->Branch("CND_Clusters_time", &CND_Clusters_time_vec);
    clas12->Branch("CND_Clusters_status", &CND_Clusters_status_vec);

    clas12->Branch("CTOF_Hits_id", &CTOF_Hits_id_vec);
    clas12->Branch("CTOF_Hits_status", &CTOF_Hits_status_vec);
    clas12->Branch("CTOF_Hits_trkID", &CTOF_Hits_trkID_vec);
    clas12->Branch("CTOF_Hits_sector", &CTOF_Hits_sector_vec);
    clas12->Branch("CTOF_Hits_layer", &CTOF_Hits_layer_vec);
    clas12->Branch("CTOF_Hits_component", &CTOF_Hits_component_vec);
    clas12->Branch("CTOF_Hits_energy", &CTOF_Hits_energy_vec);
    clas12->Branch("CTOF_Hits_time", &CTOF_Hits_time_vec);
    clas12->Branch("CTOF_Hits_energy_unc", &CTOF_Hits_energy_unc_vec);
    clas12->Branch("CTOF_Hits_time_unc", &CTOF_Hits_time_unc_vec);
    clas12->Branch("CTOF_Hits_x", &CTOF_Hits_x_vec);
    clas12->Branch("CTOF_Hits_y", &CTOF_Hits_y_vec);
    clas12->Branch("CTOF_Hits_z", &CTOF_Hits_z_vec);
    clas12->Branch("CTOF_Hits_x_unc", &CTOF_Hits_x_unc_vec);
    clas12->Branch("CTOF_Hits_y_unc", &CTOF_Hits_y_unc_vec);
    clas12->Branch("CTOF_Hits_z_unc", &CTOF_Hits_z_unc_vec);
    clas12->Branch("CTOF_Hits_tx", &CTOF_Hits_tx_vec);
    clas12->Branch("CTOF_Hits_ty", &CTOF_Hits_ty_vec);
    clas12->Branch("CTOF_Hits_tz", &CTOF_Hits_tz_vec);
    clas12->Branch("CTOF_Hits_adc_idx1", &CTOF_Hits_adc_idx1_vec);
    clas12->Branch("CTOF_Hits_adc_idx2", &CTOF_Hits_adc_idx2_vec);
    clas12->Branch("CTOF_Hits_tdc_idx1", &CTOF_Hits_tdc_idx1_vec);
    clas12->Branch("CTOF_Hits_tdc_idx2", &CTOF_Hits_tdc_idx2_vec);
    clas12->Branch("CTOF_Hits_pathLength", &CTOF_Hits_pathLength_vec);
    clas12->Branch("CTOF_Hits_pathLengthThruBar", &CTOF_Hits_pathLengthThruBar_vec);
  }

  int  entry      = 0;
  int  l          = 0;
  auto start_full = std::chrono::high_resolution_clock::now();
  while (reader->next() == true) {
    if (is_test && entry > 50000)
      break;

    reader->read(*hipo_event);
    hipo_event->getStructure(*rec_Event);
    hipo_event->getStructure(*run_Config);
    hipo_event->getStructure(*hel_Online);
    hipo_event->getStructure(*hel_Flip);
    /*
    hipo_event->getStructure(*run_Scaler);
    hipo_event->getStructure(*raw_Scaler);
    hipo_event->getStructure(*raw_Epics);
    */
    hipo_event->getStructure(*rec_Particle);
    hipo_event->getStructure(*rec_ForwardTagger);
    hipo_event->getStructure(*rec_Track);
    hipo_event->getStructure(*rec_Cherenkov);
    hipo_event->getStructure(*rec_Scintillator);
    hipo_event->getStructure(*rec_Calorimeter);
    if (cov)
      hipo_event->getStructure(*rec_CovMat);
    if (traj)
      hipo_event->getStructure(*rec_Traj);
    if (is_mc) {
      hipo_event->getStructure(*mc_Header);
      hipo_event->getStructure(*mc_Particle);
      hipo_event->getStructure(*mc_Event);
      hipo_event->getStructure(*mc_Lund);
    }
    if (tbt) {
      hipo_event->getStructure(*tbt_Tracks);
      hipo_event->getStructure(*tbt_Crosses);
      hipo_event->getStructure(*tbt_Hits);
    }
    if (hits) {
      hipo_event->getStructure(*cnd_Hits);
      hipo_event->getStructure(*cnd_Clusters);
      hipo_event->getStructure(*ctof_Hits);
    }

    if (!is_batch && (++entry % 10000) == 0)
      std::cout << "\t" << floor(100 * entry / tot_hipo_events) << "%\r\r" << std::flush;

    if (is_mc) {

      l = mc_Header->getRows();
      if (l != -1) {
        MC_Header_run_vec.resize(l);
        MC_Header_event_vec.resize(l);
        MC_Header_type_vec.resize(l);
        MC_Header_helicity_vec.resize(l);
        for (int i = 0; i < l; i++) {
          MC_Header_run_vec[i]      = mc_Header->getInt(0, i);
          MC_Header_event_vec[i]    = mc_Header->getInt(1, i);
          MC_Header_type_vec[i]     = mc_Header->getInt(2, i);
          MC_Header_helicity_vec[i] = mc_Header->getFloat(3, i);
        }
      }

      l = mc_Event->getRows();
      MC_Event_npart_vec.resize(l);
      MC_Event_ebeam_vec.resize(l);
      MC_Event_weight_vec.resize(l);
      for (int i = 0; i < l; i++) {
        MC_Event_npart_vec[i]  = mc_Event->getInt(0, i);
        MC_Event_ebeam_vec[i]  = mc_Event->getFloat(6, i);
        MC_Event_weight_vec[i] = mc_Event->getFloat(9, i);
      }

      l = mc_Particle->getRows();
      if (l != -1) {
        MC_Particle_pid_vec.resize(l);
        MC_Particle_px_vec.resize(l);
        MC_Particle_py_vec.resize(l);
        MC_Particle_pz_vec.resize(l);
        MC_Particle_vx_vec.resize(l);
        MC_Particle_vy_vec.resize(l);
        MC_Particle_vz_vec.resize(l);
        MC_Particle_vt_vec.resize(l);
        for (int i = 0; i < l; i++) {
          MC_Particle_pid_vec[i] = mc_Particle->getInt(0, i);
          MC_Particle_px_vec[i]  = mc_Particle->getFloat(1, i);
          MC_Particle_py_vec[i]  = mc_Particle->getFloat(2, i);
          MC_Particle_pz_vec[i]  = mc_Particle->getFloat(3, i);
          MC_Particle_vx_vec[i]  = mc_Particle->getFloat(4, i);
          MC_Particle_vy_vec[i]  = mc_Particle->getFloat(5, i);
          MC_Particle_vz_vec[i]  = mc_Particle->getFloat(6, i);
          MC_Particle_vt_vec[i]  = mc_Particle->getFloat(7, i);
        }
      }

      l = mc_Lund->getRows();
      if (l != -1) {
        MC_Lund_pid_vec.resize(l);
        MC_Lund_px_vec.resize(l);
        MC_Lund_py_vec.resize(l);
        MC_Lund_pz_vec.resize(l);
        MC_Lund_vx_vec.resize(l);
        MC_Lund_vy_vec.resize(l);
        MC_Lund_vz_vec.resize(l);
        MC_Lund_mass_vec.resize(l);
        MC_Lund_E_vec.resize(l);

        for (int i = 0; i < l; i++) {
          MC_Lund_pid_vec[i]  = mc_Lund->getInt(3, i);
          MC_Lund_px_vec[i]   = mc_Lund->getFloat(6, i);
          MC_Lund_py_vec[i]   = mc_Lund->getFloat(7, i);
          MC_Lund_pz_vec[i]   = mc_Lund->getFloat(8, i);
          MC_Lund_E_vec[i]    = mc_Lund->getFloat(9, i);
          MC_Lund_mass_vec[i] = mc_Lund->getFloat(10, i);
          MC_Lund_vx_vec[i]   = mc_Lund->getFloat(11, i);
          MC_Lund_vy_vec[i]   = mc_Lund->getFloat(12, i);
          MC_Lund_vz_vec[i]   = mc_Lund->getFloat(13, i);
        }
      }
    }

    l = run_Config->getRows();
    if (l != -1) {
      RUN_Config_run       = run_Config->getInt(0, 0);
      RUN_Config_event     = run_Config->getInt(1, 0);
      RUN_Config_unixtime  = run_Config->getInt(2, 0);
      RUN_Config_trigger   = run_Config->getLong(3, 0);
      RUN_Config_timestamp = run_Config->getLong(4, 0);
      RUN_Config_type      = run_Config->getInt(5, 0);
      RUN_Config_mode      = run_Config->getInt(6, 0);
      RUN_Config_torus     = run_Config->getFloat(7, 0);
      RUN_Config_solenoid  = run_Config->getFloat(8, 0);
    }
    l = hel_Online->getRows();
    if (l != -1) {
      HEL_Online_helicity    = hel_Online->getInt(0, 0);
      HEL_Online_helicityRaw = hel_Online->getInt(1, 0);
    }

    l = hel_Flip->getRows();
    if (l != -1) {
      int hel = hel_Flip->getInt(3, 0);
      if (hel == 1 || hel == -1) {
        HEL_Flip_run         = hel_Flip->getInt(0, 0);
        HEL_Flip_event       = hel_Flip->getInt(1, 0);
        HEL_Flip_timestamp   = hel_Flip->getLong(2, 0);
        HEL_Flip_helicity    = hel_Flip->getInt(3, 0);
        HEL_Flip_helicityRaw = hel_Flip->getInt(4, 0);
        HEL_Flip_pair        = hel_Flip->getInt(5, 0);
        HEL_Flip_pattern     = hel_Flip->getInt(6, 0);
        HEL_Flip_status      = hel_Flip->getInt(7, 0);
      }
    }

    l = rec_Event->getRows();
    if (l != -1) {
      REC_Event_category   = rec_Event->getLong(0, 0);
      REC_Event_topology   = rec_Event->getLong(1, 0);
      REC_Event_beamCharge = rec_Event->getFloat(2, 0);
      REC_Event_liveTime   = rec_Event->getDouble(3, 0);
      REC_Event_startTime =
          ((rec_Event->getFloat(4, 0) != -1000) ? rec_Event->getFloat(4, 0) : NAN);
      REC_Event_RFTime      = rec_Event->getFloat(5, 0);
      REC_Event_helicity    = rec_Event->getByte(6, 0);
      REC_Event_helicityRaw = rec_Event->getByte(7, 0);
      REC_Event_procTime    = rec_Event->getFloat(8, 0);
    }

    l = rec_Particle->getRows();
    if (l != -1) {
      REC_Particle_pid_vec.resize(l);
      REC_Particle_px_vec.resize(l);
      REC_Particle_py_vec.resize(l);
      REC_Particle_pz_vec.resize(l);
      REC_Particle_vx_vec.resize(l);
      REC_Particle_vy_vec.resize(l);
      REC_Particle_vz_vec.resize(l);
      REC_Particle_vt_vec.resize(l);
      REC_Particle_charge_vec.resize(l);
      REC_Particle_beta_vec.resize(l);
      REC_Particle_chi2pid_vec.resize(l);
      REC_Particle_status_vec.resize(l);

      for (int i = 0; i < l; i++) {
        REC_Particle_pid_vec[i]    = rec_Particle->getInt("pid", i);
        REC_Particle_px_vec[i]     = rec_Particle->getFloat("px", i);
        REC_Particle_py_vec[i]     = rec_Particle->getFloat("py", i);
        REC_Particle_pz_vec[i]     = rec_Particle->getFloat("pz", i);
        REC_Particle_vx_vec[i]     = rec_Particle->getFloat("vx", i);
        REC_Particle_vy_vec[i]     = rec_Particle->getFloat("vy", i);
        REC_Particle_vz_vec[i]     = rec_Particle->getFloat("vz", i);
        REC_Particle_vt_vec[i]     = rec_Particle->getFloat("vt", i);
        REC_Particle_charge_vec[i] = rec_Particle->getInt("charge", i);
        REC_Particle_beta_vec[i] =
            ((rec_Particle->getFloat("beta", i) != -9999) ? rec_Particle->getFloat("beta", i)
                                                          : NAN);
        REC_Particle_chi2pid_vec[i] = rec_Particle->getFloat("chi2pid", i);
        REC_Particle_status_vec[i]  = rec_Particle->getInt("status", i);
      }
    }
    l = rec_Calorimeter->getRows();
    if (l != -1) {
      REC_Calorimeter_index_vec.resize(l);
      REC_Calorimeter_pindex_vec.resize(l);
      REC_Calorimeter_detector_vec.resize(l);
      REC_Calorimeter_sector_vec.resize(l);
      REC_Calorimeter_layer_vec.resize(l);
      REC_Calorimeter_energy_vec.resize(l);
      REC_Calorimeter_time_vec.resize(l);
      REC_Calorimeter_path_vec.resize(l);
      REC_Calorimeter_chi2_vec.resize(l);
      REC_Calorimeter_x_vec.resize(l);
      REC_Calorimeter_y_vec.resize(l);
      REC_Calorimeter_z_vec.resize(l);
      REC_Calorimeter_hx_vec.resize(l);
      REC_Calorimeter_hy_vec.resize(l);
      REC_Calorimeter_hz_vec.resize(l);
      REC_Calorimeter_lu_vec.resize(l);
      REC_Calorimeter_lv_vec.resize(l);
      REC_Calorimeter_lw_vec.resize(l);
      REC_Calorimeter_du_vec.resize(l);
      REC_Calorimeter_dv_vec.resize(l);
      REC_Calorimeter_dw_vec.resize(l);
      REC_Calorimeter_m2u_vec.resize(l);
      REC_Calorimeter_m2v_vec.resize(l);
      REC_Calorimeter_m2w_vec.resize(l);
      REC_Calorimeter_m3u_vec.resize(l);
      REC_Calorimeter_m3v_vec.resize(l);
      REC_Calorimeter_m3w_vec.resize(l);
      REC_Calorimeter_status_vec.resize(l);

      for (int i = 0; i < l; i++) {
        REC_Calorimeter_index_vec[i]    = rec_Calorimeter->getInt(0, i);
        REC_Calorimeter_pindex_vec[i]   = rec_Calorimeter->getInt(1, i);
        REC_Calorimeter_detector_vec[i] = rec_Calorimeter->getInt(2, i);
        REC_Calorimeter_sector_vec[i]   = rec_Calorimeter->getInt(3, i);
        REC_Calorimeter_layer_vec[i]    = rec_Calorimeter->getInt(4, i);
        REC_Calorimeter_energy_vec[i]   = rec_Calorimeter->getFloat(5, i);
        REC_Calorimeter_time_vec[i]     = rec_Calorimeter->getFloat(6, i);
        REC_Calorimeter_path_vec[i]     = rec_Calorimeter->getFloat(7, i);
        REC_Calorimeter_chi2_vec[i]     = rec_Calorimeter->getFloat(8, i);
        REC_Calorimeter_x_vec[i]        = rec_Calorimeter->getFloat(9, i);
        REC_Calorimeter_y_vec[i]        = rec_Calorimeter->getFloat(10, i);
        REC_Calorimeter_z_vec[i]        = rec_Calorimeter->getFloat(11, i);
        REC_Calorimeter_hx_vec[i]       = rec_Calorimeter->getFloat(12, i);
        REC_Calorimeter_hy_vec[i]       = rec_Calorimeter->getFloat(13, i);
        REC_Calorimeter_hz_vec[i]       = rec_Calorimeter->getFloat(14, i);
        REC_Calorimeter_lu_vec[i]       = rec_Calorimeter->getFloat(15, i);
        REC_Calorimeter_lv_vec[i]       = rec_Calorimeter->getFloat(16, i);
        REC_Calorimeter_lw_vec[i]       = rec_Calorimeter->getFloat(17, i);
        REC_Calorimeter_du_vec[i]       = rec_Calorimeter->getFloat(18, i);
        REC_Calorimeter_dv_vec[i]       = rec_Calorimeter->getFloat(19, i);
        REC_Calorimeter_dw_vec[i]       = rec_Calorimeter->getFloat(20, i);
        REC_Calorimeter_m2u_vec[i]      = rec_Calorimeter->getFloat(21, i);
        REC_Calorimeter_m2v_vec[i]      = rec_Calorimeter->getFloat(22, i);
        REC_Calorimeter_m2w_vec[i]      = rec_Calorimeter->getFloat(23, i);
        REC_Calorimeter_m3u_vec[i]      = rec_Calorimeter->getFloat(24, i);
        REC_Calorimeter_m3v_vec[i]      = rec_Calorimeter->getFloat(25, i);
        REC_Calorimeter_m3w_vec[i]      = rec_Calorimeter->getFloat(26, i);
        REC_Calorimeter_status_vec[i]   = rec_Calorimeter->getInt(27, i);
      }
    }
    l = rec_Cherenkov->getRows();
    if (l != -1) {
      REC_Cherenkov_index_vec.resize(l);
      REC_Cherenkov_pindex_vec.resize(l);
      REC_Cherenkov_detector_vec.resize(l);
      REC_Cherenkov_sector_vec.resize(l);
      REC_Cherenkov_nphe_vec.resize(l);
      REC_Cherenkov_time_vec.resize(l);
      REC_Cherenkov_path_vec.resize(l);
      REC_Cherenkov_chi2_vec.resize(l);
      REC_Cherenkov_x_vec.resize(l);
      REC_Cherenkov_y_vec.resize(l);
      REC_Cherenkov_z_vec.resize(l);
      REC_Cherenkov_dtheta_vec.resize(l);
      REC_Cherenkov_dphi_vec.resize(l);
      REC_Cherenkov_status_vec.resize(l);

      for (int i = 0; i < l; i++) {
        REC_Cherenkov_index_vec[i]    = rec_Cherenkov->getInt(0, i);
        REC_Cherenkov_pindex_vec[i]   = rec_Cherenkov->getInt(1, i);
        REC_Cherenkov_detector_vec[i] = rec_Cherenkov->getInt(2, i);
        REC_Cherenkov_sector_vec[i]   = rec_Cherenkov->getInt(3, i);
        REC_Cherenkov_nphe_vec[i]     = rec_Cherenkov->getFloat(4, i);
        REC_Cherenkov_time_vec[i]     = rec_Cherenkov->getFloat(5, i);
        REC_Cherenkov_path_vec[i]     = rec_Cherenkov->getFloat(6, i);
        REC_Cherenkov_chi2_vec[i]     = rec_Cherenkov->getFloat(7, i);
        REC_Cherenkov_x_vec[i]        = rec_Cherenkov->getFloat(8, i);
        REC_Cherenkov_y_vec[i]        = rec_Cherenkov->getFloat(9, i);
        REC_Cherenkov_z_vec[i]        = rec_Cherenkov->getFloat(10, i);
        REC_Cherenkov_dtheta_vec[i]   = rec_Cherenkov->getFloat(11, i);
        REC_Cherenkov_dphi_vec[i]     = rec_Cherenkov->getFloat(12, i);
        REC_Cherenkov_status_vec[i]   = rec_Cherenkov->getShort(13, i);
      }
    }
    l = rec_Scintillator->getRows();
    if (l != -1) {
      REC_Scintillator_index_vec.resize(l);
      REC_Scintillator_pindex_vec.resize(l);
      REC_Scintillator_detector_vec.resize(l);
      REC_Scintillator_sector_vec.resize(l);
      REC_Scintillator_layer_vec.resize(l);
      REC_Scintillator_component_vec.resize(l);
      REC_Scintillator_energy_vec.resize(l);
      REC_Scintillator_time_vec.resize(l);
      REC_Scintillator_path_vec.resize(l);
      REC_Scintillator_chi2_vec.resize(l);
      REC_Scintillator_x_vec.resize(l);
      REC_Scintillator_y_vec.resize(l);
      REC_Scintillator_z_vec.resize(l);
      REC_Scintillator_hx_vec.resize(l);
      REC_Scintillator_hy_vec.resize(l);
      REC_Scintillator_hz_vec.resize(l);
      REC_Scintillator_status_vec.resize(l);

      for (int i = 0; i < l; i++) {
        REC_Scintillator_index_vec[i]     = rec_Scintillator->getInt(0, i);
        REC_Scintillator_pindex_vec[i]    = rec_Scintillator->getInt(1, i);
        REC_Scintillator_detector_vec[i]  = rec_Scintillator->getInt(2, i);
        REC_Scintillator_sector_vec[i]    = rec_Scintillator->getInt(3, i);
        REC_Scintillator_layer_vec[i]     = rec_Scintillator->getInt(4, i);
        REC_Scintillator_component_vec[i] = rec_Scintillator->getInt(5, i);
        REC_Scintillator_energy_vec[i]    = rec_Scintillator->getFloat(6, i);
        REC_Scintillator_time_vec[i]      = rec_Scintillator->getFloat(7, i);
        REC_Scintillator_path_vec[i]      = rec_Scintillator->getFloat(8, i);
        REC_Scintillator_chi2_vec[i]      = rec_Scintillator->getFloat(9, i);
        REC_Scintillator_x_vec[i]         = rec_Scintillator->getFloat(10, i);
        REC_Scintillator_y_vec[i]         = rec_Scintillator->getFloat(11, i);
        REC_Scintillator_z_vec[i]         = rec_Scintillator->getFloat(12, i);
        REC_Scintillator_hx_vec[i]        = rec_Scintillator->getFloat(13, i);
        REC_Scintillator_hy_vec[i]        = rec_Scintillator->getFloat(14, i);
        REC_Scintillator_hz_vec[i]        = rec_Scintillator->getFloat(15, i);
        REC_Scintillator_status_vec[i]    = rec_Scintillator->getInt(16, i);
      }
    }
    l = rec_ForwardTagger->getRows();
    if (l != -1) {
      REC_ForwardTagger_index_vec.resize(l);
      REC_ForwardTagger_pindex_vec.resize(l);
      REC_ForwardTagger_detector_vec.resize(l);
      REC_ForwardTagger_layer_vec.resize(l);
      REC_ForwardTagger_energy_vec.resize(l);
      REC_ForwardTagger_time_vec.resize(l);
      REC_ForwardTagger_path_vec.resize(l);
      REC_ForwardTagger_chi2_vec.resize(l);
      REC_ForwardTagger_x_vec.resize(l);
      REC_ForwardTagger_y_vec.resize(l);
      REC_ForwardTagger_z_vec.resize(l);
      REC_ForwardTagger_dx_vec.resize(l);
      REC_ForwardTagger_dy_vec.resize(l);
      REC_ForwardTagger_radius_vec.resize(l);
      REC_ForwardTagger_size_vec.resize(l);
      REC_ForwardTagger_status_vec.resize(l);
      for (int i = 0; i < l; i++) {
        REC_ForwardTagger_index_vec[i]    = rec_ForwardTagger->getInt(0, i);
        REC_ForwardTagger_pindex_vec[i]   = rec_ForwardTagger->getInt(1, i);
        REC_ForwardTagger_detector_vec[i] = rec_ForwardTagger->getInt(2, i);
        REC_ForwardTagger_layer_vec[i]    = rec_ForwardTagger->getInt(3, i);
        REC_ForwardTagger_energy_vec[i]   = rec_ForwardTagger->getFloat(4, i);
        REC_ForwardTagger_time_vec[i]     = rec_ForwardTagger->getFloat(5, i);
        REC_ForwardTagger_path_vec[i]     = rec_ForwardTagger->getFloat(6, i);
        REC_ForwardTagger_chi2_vec[i]     = rec_ForwardTagger->getFloat(7, i);
        REC_ForwardTagger_x_vec[i]        = rec_ForwardTagger->getFloat(8, i);
        REC_ForwardTagger_y_vec[i]        = rec_ForwardTagger->getFloat(9, i);
        REC_ForwardTagger_z_vec[i]        = rec_ForwardTagger->getFloat(10, i);
        REC_ForwardTagger_dx_vec[i]       = rec_ForwardTagger->getFloat(11, i);
        REC_ForwardTagger_dy_vec[i]       = rec_ForwardTagger->getFloat(12, i);
        REC_ForwardTagger_radius_vec[i]   = rec_ForwardTagger->getFloat(13, i);
        REC_ForwardTagger_size_vec[i]     = rec_ForwardTagger->getShort(14, i);
        REC_ForwardTagger_status_vec[i]   = rec_ForwardTagger->getShort(15, i);
      }
    }

    l = rec_Track->getRows();
    if (l != -1) {
      REC_Track_index_vec.resize(l);
      REC_Track_pindex_vec.resize(l);
      REC_Track_detector_vec.resize(l);
      REC_Track_sector_vec.resize(l);
      REC_Track_status_vec.resize(l);
      REC_Track_q_vec.resize(l);
      REC_Track_chi2_vec.resize(l);
      REC_Track_NDF_vec.resize(l);

      for (int i = 0; i < l; i++) {
        REC_Track_index_vec[i]    = rec_Track->getShort(0, i);
        REC_Track_pindex_vec[i]   = rec_Track->getShort(1, i);
        REC_Track_detector_vec[i] = rec_Track->getByte(2, i);
        REC_Track_sector_vec[i]   = rec_Track->getByte(3, i);
        REC_Track_status_vec[i]   = rec_Track->getShort(4, i);
        REC_Track_q_vec[i]        = rec_Track->getByte(5, i);
        REC_Track_chi2_vec[i]     = rec_Track->getFloat(6, i);
        REC_Track_NDF_vec[i]      = rec_Track->getShort(7, i);
      }
    }
    if (cov) {
      l = rec_CovMat->getRows();
      if (l != -1) {
        REC_CovMat_index_vec.resize(l);
        REC_CovMat_pindex_vec.resize(l);
        REC_CovMat_C11_vec.resize(l);
        REC_CovMat_C12_vec.resize(l);
        REC_CovMat_C13_vec.resize(l);
        REC_CovMat_C14_vec.resize(l);
        REC_CovMat_C15_vec.resize(l);
        REC_CovMat_C22_vec.resize(l);
        REC_CovMat_C23_vec.resize(l);
        REC_CovMat_C24_vec.resize(l);
        REC_CovMat_C25_vec.resize(l);
        REC_CovMat_C33_vec.resize(l);
        REC_CovMat_C34_vec.resize(l);
        REC_CovMat_C35_vec.resize(l);
        REC_CovMat_C44_vec.resize(l);
        REC_CovMat_C45_vec.resize(l);
        REC_CovMat_C55_vec.resize(l);

        for (int i = 0; i < l; i++) {
          REC_CovMat_index_vec[i]  = rec_CovMat->getInt(0, i);
          REC_CovMat_pindex_vec[i] = rec_CovMat->getInt(1, i);
          REC_CovMat_C11_vec[i]    = rec_CovMat->getFloat(2, i);
          REC_CovMat_C12_vec[i]    = rec_CovMat->getFloat(3, i);
          REC_CovMat_C13_vec[i]    = rec_CovMat->getFloat(4, i);
          REC_CovMat_C14_vec[i]    = rec_CovMat->getFloat(5, i);
          REC_CovMat_C15_vec[i]    = rec_CovMat->getFloat(6, i);
          REC_CovMat_C22_vec[i]    = rec_CovMat->getFloat(7, i);
          REC_CovMat_C23_vec[i]    = rec_CovMat->getFloat(8, i);
          REC_CovMat_C24_vec[i]    = rec_CovMat->getFloat(9, i);
          REC_CovMat_C25_vec[i]    = rec_CovMat->getFloat(10, i);
          REC_CovMat_C33_vec[i]    = rec_CovMat->getFloat(11, i);
          REC_CovMat_C34_vec[i]    = rec_CovMat->getFloat(12, i);
          REC_CovMat_C35_vec[i]    = rec_CovMat->getFloat(13, i);
          REC_CovMat_C44_vec[i]    = rec_CovMat->getFloat(14, i);
          REC_CovMat_C45_vec[i]    = rec_CovMat->getFloat(15, i);
          REC_CovMat_C55_vec[i]    = rec_CovMat->getFloat(16, i);
        }
      }
    }

    if (tbt) {
      l = tbt_Tracks->getRows();
      TBT_Tracks_id_vec.resize(l);
      TBT_Tracks_sector_vec.resize(l);
      TBT_Tracks_vx_vec.resize(l);
      TBT_Tracks_vy_vec.resize(l);
      TBT_Tracks_vz_vec.resize(l);
      TBT_Tracks_Cross1_ID_vec.resize(l);
      TBT_Tracks_Cross2_ID_vec.resize(l);
      TBT_Tracks_Cross3_ID_vec.resize(l);
      TBT_Tracks_chi2_vec.resize(l);
      TBT_Tracks_ndf_vec.resize(l);

      for (int i = 0; i < l; i++) {
        TBT_Tracks_id_vec[i]     = tbt_Tracks->getInt(0, i);
        TBT_Tracks_sector_vec[i] = tbt_Tracks->getInt(2, i);
        /*
                TBT_Tracks_vx_vec[i]        = tbt_Tracks->getFloat(21, i);
                TBT_Tracks_vy_vec[i]        = tbt_Tracks->getFloat(22, i);
                TBT_Tracks_vz_vec[i]        = tbt_Tracks->getFloat(23, i);
        */
        TBT_Tracks_Cross1_ID_vec[i] = tbt_Tracks->getFloat(27, i);
        TBT_Tracks_Cross2_ID_vec[i] = tbt_Tracks->getFloat(28, i);
        TBT_Tracks_Cross3_ID_vec[i] = tbt_Tracks->getFloat(29, i);
        TBT_Tracks_chi2_vec[i]      = tbt_Tracks->getFloat(32, i);
        TBT_Tracks_ndf_vec[i]       = tbt_Tracks->getInt(33, i);
      }

      l = tbt_Crosses->getRows();
      TBT_Crosses_id_vec.resize(l);
      TBT_Crosses_sector_vec.resize(l);
      TBT_Crosses_region_vec.resize(l);
      TBT_Crosses_x_vec.resize(l);
      TBT_Crosses_y_vec.resize(l);
      TBT_Crosses_z_vec.resize(l);
      TBT_Crosses_err_x_vec.resize(l);
      TBT_Crosses_err_y_vec.resize(l);
      TBT_Crosses_err_z_vec.resize(l);
      TBT_Crosses_ux_vec.resize(l);
      TBT_Crosses_uy_vec.resize(l);
      TBT_Crosses_uz_vec.resize(l);
      TBT_Crosses_err_ux_vec.resize(l);
      TBT_Crosses_err_uy_vec.resize(l);
      TBT_Crosses_err_uz_vec.resize(l);

      for (int i = 0; i < l; i++) {
        TBT_Crosses_id_vec[i]     = tbt_Crosses->getInt(0, i);
        TBT_Crosses_sector_vec[i] = tbt_Crosses->getInt(2, i);
        TBT_Crosses_region_vec[i] = tbt_Crosses->getInt(3, i);
        TBT_Crosses_x_vec[i]      = tbt_Crosses->getFloat(4, i);
        TBT_Crosses_y_vec[i]      = tbt_Crosses->getFloat(5, i);
        TBT_Crosses_z_vec[i]      = tbt_Crosses->getFloat(6, i);
        TBT_Crosses_err_x_vec[i]  = tbt_Crosses->getFloat(7, i);
        TBT_Crosses_err_y_vec[i]  = tbt_Crosses->getFloat(8, i);
        TBT_Crosses_err_z_vec[i]  = tbt_Crosses->getFloat(9, i);
        TBT_Crosses_ux_vec[i]     = tbt_Crosses->getFloat(10, i);
        TBT_Crosses_uy_vec[i]     = tbt_Crosses->getFloat(11, i);
        TBT_Crosses_uz_vec[i]     = tbt_Crosses->getFloat(12, i);
        TBT_Crosses_err_ux_vec[i] = tbt_Crosses->getFloat(13, i);
        TBT_Crosses_err_uy_vec[i] = tbt_Crosses->getFloat(14, i);
        TBT_Crosses_err_uz_vec[i] = tbt_Crosses->getFloat(15, i);
      }

      l = tbt_Hits->getRows();
      TBT_Hits_id_vec.resize(l);
      TBT_Hits_sector_vec.resize(l);
      TBT_Hits_superlayer_vec.resize(l);
      TBT_Hits_layer_vec.resize(l);
      TBT_Hits_wire_vec.resize(l);
      TBT_Hits_trkID_vec.resize(l);
      TBT_Hits_doca_vec.resize(l);
      TBT_Hits_docaError_vec.resize(l);
      TBT_Hits_trkDoca_vec.resize(l);
      TBT_Hits_timeResidual_vec.resize(l);
      TBT_Hits_fitResidual_vec.resize(l);

      for (int i = 0; i < l; i++) {
        TBT_Hits_id_vec[i]           = tbt_Hits->getInt(0, i);
        TBT_Hits_sector_vec[i]       = tbt_Hits->getInt(2, i);
        TBT_Hits_superlayer_vec[i]   = tbt_Hits->getInt(3, i);
        TBT_Hits_layer_vec[i]        = tbt_Hits->getInt(4, i);
        TBT_Hits_wire_vec[i]         = tbt_Hits->getInt(5, i);
        TBT_Hits_doca_vec[i]         = tbt_Hits->getFloat(7, i);
        TBT_Hits_docaError_vec[i]    = tbt_Hits->getFloat(8, i);
        TBT_Hits_trkDoca_vec[i]      = tbt_Hits->getFloat(9, i);
        TBT_Hits_timeResidual_vec[i] = tbt_Hits->getFloat(10, i);
        TBT_Hits_fitResidual_vec[i]  = tbt_Hits->getFloat(11, i);
        TBT_Hits_trkID_vec[i]        = tbt_Hits->getInt(22, i);
      }
    }

    if (traj) {
      l = rec_Traj->getRows();
      if (l != -1) {
        REC_Traj_pindex_vec.resize(l);
        REC_Traj_index_vec.resize(l);
        REC_Traj_detector_vec.resize(l);
        REC_Traj_layer_vec.resize(l);
        REC_Traj_x_vec.resize(l);
        REC_Traj_y_vec.resize(l);
        REC_Traj_z_vec.resize(l);
        REC_Traj_cx_vec.resize(l);
        REC_Traj_cy_vec.resize(l);
        REC_Traj_cz_vec.resize(l);
        REC_Traj_path_vec.resize(l);

        for (int i = 0; i < l; i++) {
          REC_Traj_index_vec[i]    = rec_Traj->getInt(0, i);
          REC_Traj_pindex_vec[i]   = rec_Traj->getInt(1, i);
          REC_Traj_detector_vec[i] = rec_Traj->getInt(2, i);
          REC_Traj_layer_vec[i]    = rec_Traj->getInt(3, i);
          REC_Traj_x_vec[i]        = rec_Traj->getFloat(4, i);
          REC_Traj_y_vec[i]        = rec_Traj->getFloat(5, i);
          REC_Traj_z_vec[i]        = rec_Traj->getFloat(6, i);
          REC_Traj_cx_vec[i]       = rec_Traj->getFloat(7, i);
          REC_Traj_cy_vec[i]       = rec_Traj->getFloat(8, i);
          REC_Traj_cz_vec[i]       = rec_Traj->getFloat(9, i);
          REC_Traj_path_vec[i]     = rec_Traj->getFloat(10, i);
        }
      }
    }
    if (hits) {
      l = cnd_Hits->getRows();
      if (l != -1) {
        CND_Hits_id_vec.resize(l);
        CND_Hits_status_vec.resize(l);
        CND_Hits_trkID_vec.resize(l);
        CND_Hits_sector_vec.resize(l);
        CND_Hits_layer_vec.resize(l);
        CND_Hits_component_vec.resize(l);
        CND_Hits_energy_vec.resize(l);
        CND_Hits_time_vec.resize(l);
        CND_Hits_energy_unc_vec.resize(l);
        CND_Hits_time_unc_vec.resize(l);
        CND_Hits_x_vec.resize(l);
        CND_Hits_y_vec.resize(l);
        CND_Hits_z_vec.resize(l);
        CND_Hits_x_unc_vec.resize(l);
        CND_Hits_y_unc_vec.resize(l);
        CND_Hits_z_unc_vec.resize(l);
        CND_Hits_tx_vec.resize(l);
        CND_Hits_ty_vec.resize(l);
        CND_Hits_tz_vec.resize(l);
        CND_Hits_tlength_vec.resize(l);
        CND_Hits_pathlength_vec.resize(l);
        CND_Hits_indexLadc_vec.resize(l);
        CND_Hits_indexRadc_vec.resize(l);
        CND_Hits_indexLtdc_vec.resize(l);
        CND_Hits_indexRtdc_vec.resize(l);

        for (int i = 0; i < l; i++) {
          CND_Hits_id_vec[i]         = cnd_Hits->getInt("id", i);
          CND_Hits_status_vec[i]     = cnd_Hits->getInt("status", i);
          CND_Hits_trkID_vec[i]      = cnd_Hits->getInt("trkID", i);
          CND_Hits_sector_vec[i]     = cnd_Hits->getInt("sector", i);
          CND_Hits_layer_vec[i]      = cnd_Hits->getInt("layer", i);
          CND_Hits_component_vec[i]  = cnd_Hits->getInt("component", i);
          CND_Hits_energy_vec[i]     = cnd_Hits->getFloat("energy", i);
          CND_Hits_time_vec[i]       = cnd_Hits->getFloat("time", i);
          CND_Hits_energy_unc_vec[i] = cnd_Hits->getFloat("energy_unc", i);
          CND_Hits_time_unc_vec[i]   = cnd_Hits->getFloat("time_unc", i);
          CND_Hits_x_vec[i]          = cnd_Hits->getFloat("x", i);
          CND_Hits_y_vec[i]          = cnd_Hits->getFloat("y", i);
          CND_Hits_z_vec[i]          = cnd_Hits->getFloat("z", i);
          CND_Hits_x_unc_vec[i]      = cnd_Hits->getFloat("x_unc", i);
          CND_Hits_y_unc_vec[i]      = cnd_Hits->getFloat("y_unc", i);
          CND_Hits_z_unc_vec[i]      = cnd_Hits->getFloat("z_unc", i);
          CND_Hits_tx_vec[i]         = cnd_Hits->getFloat("tx", i);
          CND_Hits_ty_vec[i]         = cnd_Hits->getFloat("ty", i);
          CND_Hits_tz_vec[i]         = cnd_Hits->getFloat("tz", i);
          CND_Hits_tlength_vec[i]    = cnd_Hits->getFloat("tlength", i);
          CND_Hits_pathlength_vec[i] = cnd_Hits->getFloat("pathlength", i);
          CND_Hits_indexLadc_vec[i]  = cnd_Hits->getInt("indexLadc", i);
          CND_Hits_indexRadc_vec[i]  = cnd_Hits->getInt("indexRadc", i);
          CND_Hits_indexLtdc_vec[i]  = cnd_Hits->getInt("indexLtdc", i);
          CND_Hits_indexRtdc_vec[i]  = cnd_Hits->getInt("indexRtdc", i);
        }
      }

      l = cnd_Clusters->getRows();
      if (l != -1) {
        CND_Clusters_id_vec.resize(l);
        CND_Clusters_sector_vec.resize(l);
        CND_Clusters_layer_vec.resize(l);
        CND_Clusters_component_vec.resize(l);
        CND_Clusters_nhits_vec.resize(l);
        CND_Clusters_energy_vec.resize(l);
        CND_Clusters_x_vec.resize(l);
        CND_Clusters_y_vec.resize(l);
        CND_Clusters_z_vec.resize(l);
        CND_Clusters_time_vec.resize(l);
        CND_Clusters_status_vec.resize(l);

        for (int i = 0; i < l; i++) {
          CND_Clusters_id_vec[i]        = cnd_Clusters->getInt("id", i);
          CND_Clusters_sector_vec[i]    = cnd_Clusters->getInt("sector", i);
          CND_Clusters_layer_vec[i]     = cnd_Clusters->getInt("layer", i);
          CND_Clusters_component_vec[i] = cnd_Clusters->getInt("component", i);
          CND_Clusters_nhits_vec[i]     = cnd_Clusters->getInt("nhits", i);
          CND_Clusters_energy_vec[i]    = cnd_Clusters->getFloat("energy", i);
          CND_Clusters_x_vec[i]         = cnd_Clusters->getFloat("x", i);
          CND_Clusters_y_vec[i]         = cnd_Clusters->getFloat("y", i);
          CND_Clusters_z_vec[i]         = cnd_Clusters->getFloat("z", i);
          CND_Clusters_time_vec[i]      = cnd_Clusters->getFloat("time", i);
          CND_Clusters_status_vec[i]    = cnd_Clusters->getInt("status", i);
        }
      }

      l = ctof_Hits->getRows();
      if (l != -1) {
        CTOF_Hits_id_vec.resize(l);
        CTOF_Hits_status_vec.resize(l);
        CTOF_Hits_trkID_vec.resize(l);
        CTOF_Hits_sector_vec.resize(l);
        CTOF_Hits_layer_vec.resize(l);
        CTOF_Hits_component_vec.resize(l);
        CTOF_Hits_energy_vec.resize(l);
        CTOF_Hits_time_vec.resize(l);
        CTOF_Hits_energy_unc_vec.resize(l);
        CTOF_Hits_time_unc_vec.resize(l);
        CTOF_Hits_x_vec.resize(l);
        CTOF_Hits_y_vec.resize(l);
        CTOF_Hits_z_vec.resize(l);
        CTOF_Hits_x_unc_vec.resize(l);
        CTOF_Hits_y_unc_vec.resize(l);
        CTOF_Hits_z_unc_vec.resize(l);
        CTOF_Hits_tx_vec.resize(l);
        CTOF_Hits_ty_vec.resize(l);
        CTOF_Hits_tz_vec.resize(l);
        CTOF_Hits_adc_idx1_vec.resize(l);
        CTOF_Hits_adc_idx2_vec.resize(l);
        CTOF_Hits_tdc_idx1_vec.resize(l);
        CTOF_Hits_tdc_idx2_vec.resize(l);
        CTOF_Hits_pathLength_vec.resize(l);
        CTOF_Hits_pathLengthThruBar_vec.resize(l);

        for (int i = 0; i < l; i++) {
          CTOF_Hits_id_vec[i]                = ctof_Hits->getInt("id", i);
          CTOF_Hits_status_vec[i]            = ctof_Hits->getInt("status", i);
          CTOF_Hits_trkID_vec[i]             = ctof_Hits->getInt("trkID", i);
          CTOF_Hits_sector_vec[i]            = ctof_Hits->getInt("sector", i);
          CTOF_Hits_layer_vec[i]             = ctof_Hits->getInt("layer", i);
          CTOF_Hits_component_vec[i]         = ctof_Hits->getInt("component", i);
          CTOF_Hits_energy_vec[i]            = ctof_Hits->getFloat("energy", i);
          CTOF_Hits_time_vec[i]              = ctof_Hits->getFloat("time", i);
          CTOF_Hits_energy_unc_vec[i]        = ctof_Hits->getFloat("energy_unc", i);
          CTOF_Hits_time_unc_vec[i]          = ctof_Hits->getFloat("time_unc", i);
          CTOF_Hits_x_vec[i]                 = ctof_Hits->getFloat("x", i);
          CTOF_Hits_y_vec[i]                 = ctof_Hits->getFloat("y", i);
          CTOF_Hits_z_vec[i]                 = ctof_Hits->getFloat("z", i);
          CTOF_Hits_x_unc_vec[i]             = ctof_Hits->getFloat("x_unc", i);
          CTOF_Hits_y_unc_vec[i]             = ctof_Hits->getFloat("y_unc", i);
          CTOF_Hits_z_unc_vec[i]             = ctof_Hits->getFloat("z_unc", i);
          CTOF_Hits_tx_vec[i]                = ctof_Hits->getFloat("tx", i);
          CTOF_Hits_ty_vec[i]                = ctof_Hits->getFloat("ty", i);
          CTOF_Hits_tz_vec[i]                = ctof_Hits->getFloat("tz", i);
          CTOF_Hits_adc_idx1_vec[i]          = ctof_Hits->getInt("adc_idx1", i);
          CTOF_Hits_adc_idx2_vec[i]          = ctof_Hits->getInt("adc_idx2", i);
          CTOF_Hits_tdc_idx1_vec[i]          = ctof_Hits->getInt("tdc_idx1", i);
          CTOF_Hits_tdc_idx2_vec[i]          = ctof_Hits->getInt("tdc_idx2", i);
          CTOF_Hits_pathLength_vec[i]        = ctof_Hits->getFloat("pathLength", i);
          CTOF_Hits_pathLengthThruBar_vec[i] = ctof_Hits->getFloat("pathLengthThruBar", i);
        }
      }
    }

    clas12->Fill();
  }
  OutputFile->cd();
  clas12->Write();
  OutputFile->Close();

  if (!is_batch) {
    std::chrono::duration<double> elapsed_full =
        (std::chrono::high_resolution_clock::now() - start_full);
    std::cout << "Elapsed time: " << elapsed_full.count() << " s" << std::endl;
    std::cout << "Events/Sec: " << entry / elapsed_full.count() << " Hz" << std::endl;
    std::cout << "Total events in file: " << entry << std::endl;
  }

  return 0;
}
